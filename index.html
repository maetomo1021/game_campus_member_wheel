<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>チュートリアル移動確認</title>

  <!-- OGP：Discordに貼った時のプレビュー -->
  <meta property="og:title" content="チュートリアルに移動しますか？">
  <meta property="og:description" content="確認後、自動でチュートリアルページに移動します。">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://your-domain.com/ogp.png">
  <meta property="og:url" content="https://your-domain.com/tutorial-confirm.html">

  <style>
    :root {
      --bg: #0b1020;
      --card: #121a33;
      --text: #eaf0ff;
      --muted: #a8b3cf;
      --accent: #3b82f6;
      --ok: #22c55e;
      --ng: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: linear-gradient(180deg,#0b1020,#0d1428 40%,#0b1020);
      color: var(--text); font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      min-height: 100svh; display: grid; place-items: center; padding: 16px;
    }
    .wrap { width: min(960px, 100%); }
    .card {
      background: var(--card); border: 1px solid #1f2a4d; border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35); overflow: hidden;
    }
    .hero { position: relative; aspect-ratio: 16/9; background:#0a0f1f; overflow: hidden; }
    .slide {
      position: absolute; inset: 0; opacity: 0; transition: opacity .6s ease;
      display: grid; place-items: center; background:#000;
    }
    .slide.active { opacity: 1; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    .dots { position: absolute; left: 50%; bottom: 10px; transform: translateX(-50%); display: flex; gap: 8px; }
    .dot { width: 10px; height: 10px; border-radius: 999px; background: #6273a6; opacity: .6; }
    .dot.active { background: #cbd8ff; opacity: 1; }

    .body { padding: 20px 22px 16px; }
    h1 { margin: 0 0 6px; font-size: clamp(20px, 3.5vw, 26px); }
    .desc { color: var(--muted); margin: 0 0 14px; }

    .confirm {
      display: none; /* ← 初期は非表示 */
      flex-wrap: wrap; align-items: center; gap: 12px; justify-content: space-between;
      padding: 12px; border: 1px dashed #2a3761; border-radius: 12px; background: rgba(59,130,246,.08);
    }
    .timer { font-weight: 700; color: #cde1ff; }
    .btns { display: flex; gap: 10px; }
    button {
      cursor: pointer; border: none; border-radius: 10px; padding: 10px 16px; font-weight: 700;
      transition: transform .05s ease, opacity .2s ease; color: #fff;
    }
    button:active { transform: translateY(1px); }
    .ok { background: var(--ok); }
    .cancel { background: var(--ng); }
    .ghost { background: transparent; color: var(--muted); border: 1px solid #2a3761; }

    .foot {
      padding: 12px 22px 20px; color: var(--muted); font-size: 14px; display: flex; justify-content: space-between; gap: 8px; flex-wrap: wrap;
    }
    a.safe { color: #a0c6ff; text-decoration: underline; }
    .small { font-size: 12px; opacity: .85; }
    @media (max-width: 520px) {
      .confirm { gap: 8px; }
      .btns { width: 100%; justify-content: flex-end; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <!-- 画像スライド -->
      <div class="hero" id="hero">
        <div class="slide active"><img src="./welcome-01.png" alt="ゲーム学園ようこそ"></div>
        <div class="slide"><img src="./headmaster-01.png" alt="学園長紹介1"></div>
        <div class="slide"><img src="./headmaster-02.png" alt="学園長紹介2"></div>
        <div class="slide"><img src="./rules-01.png" alt="学園ルール"></div>
        <div class="dots" id="dots"></div>
      </div>

      <div class="body">
        <h1 id="title">ご案内を表示中です…</h1>
        <p class="desc" id="desc">
          スライドショーが終了したのち、確認のうえ移動できます。
        </p>

        <div class="confirm" id="confirmBox">
          <div>
            行き先：<span id="destText"></span><br class="small">
            <span class="small">（※安全のためワンクッションページを挟んでいます）</span>
          </div>
          <div class="btns">
            <button class="ok" id="goBtn">はい、移動する</button>
            <button class="cancel" id="stopBtn">キャンセル</button>
            <button class="ghost" id="pauseBtn" aria-pressed="false">一時停止</button>
          </div>
        </div>
      </div>

      <div class="foot">
        <div>自動で移動しない場合は <a class="safe" id="fallback" target="_blank" rel="noopener">こちらをクリック</a></div>
        <div class="small">© ゲーム学園</div>
      </div>
    </div>
  </div>

  <script>
    // ===== 設定（クエリで上書き可） =====
    const q = new URLSearchParams(location.search);
    const dest  = q.get("to") || "https://game.example.com/tutorial"; // ← Discord部屋URLに差し替え可
    const SLIDE_MS = 6000;     // ★ 4秒ごとに次のスライド
    const AFTER_SLIDES_SHOW_CONFIRM_MS = 5000; // ★ 全スライド終了の5秒後に確認UIを表示

    // 反映
    document.getElementById("destText").textContent = dest;
    const fallback = document.getElementById("fallback");
    fallback.href = dest;

    // --- スライド制御（1周したら停止） ---
    const slides = [...document.querySelectorAll(".slide")];
    const dotsWrap = document.getElementById("dots");
    slides.forEach((_, i) => {
      const d = document.createElement("span");
      d.className = "dot" + (i===0 ? " active" : "");
      dotsWrap.appendChild(d);
    });
    const dots = [...dotsWrap.children];

    let idx = 0;
    const advance = () => {
      // 次のスライドに進める
      slides[idx].classList.remove("active");
      dots[idx].classList.remove("active");
      idx++;
      slides[idx].classList.add("active");
      dots[idx].classList.add("active");

      // 最後のスライドを表示し終えたら回転停止 → 5秒後に確認UI
      if (idx === slides.length - 1) {
        clearInterval(rot);
        setTimeout(showConfirmUI, AFTER_SLIDES_SHOW_CONFIRM_MS);
      }
    };
    const rot = setInterval(advance, SLIDE_MS);

    // --- 確認UI表示（自動遷移はしない・OKでのみ遷移） ---
    function showConfirmUI() {
      document.getElementById("title").textContent = "ページ遷移しますか？";
      document.getElementById("desc").textContent  = "確認のうえ、Discordの部屋へ移動できます。";
      document.getElementById("confirmBox").style.display = "flex";
    }

    // --- 遷移/キャンセル/一時停止 ---
    function go() { location.href = dest; } // Discord招待など
    function cancel() {
      document.getElementById("desc").textContent = "移動はキャンセルされました。ボタンやリンクから手動で移動できます。";
      document.getElementById("confirmBox").style.display = "none";
    }

    let paused = false;
    document.getElementById("goBtn").addEventListener("click", go);
    document.getElementById("stopBtn").addEventListener("click", cancel);
    document.getElementById("pauseBtn").addEventListener("click", (e) => {
      paused = !paused;
      e.currentTarget.setAttribute("aria-pressed", String(paused));
      e.currentTarget.textContent = paused ? "再開" : "一時停止";
      if (paused) {
        clearInterval(rot); // スライド停止
      } else {
        // 再開時：最後でなければ回転を再開、最後なら確認表示の予約を再実行
        if (idx < slides.length - 1) {
          window.rot = setInterval(advance, SLIDE_MS);
        } else {
          showConfirmUI();
        }
      }
    });

    // JS無効/埋め込み対策は <noscript> を下に保持
  </script>

  <noscript>
    <div style="position:fixed;inset:0;display:grid;place-items:center;background:#0008;color:#fff;font:16px/1.6 system-ui,sans-serif;text-align:center;padding:20px">
      JavaScriptが無効のため自動表示/確認ができません。<br>
      <a href="https://game.example.com/tutorial" style="color:#9cf;text-decoration:underline">こちらをクリック</a>して移動してください。
    </div>
  </noscript>
</body>
</html>
